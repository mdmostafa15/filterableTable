<!DOCTYPE html>
<html lang="en" dir="ltr">

<head>
  <meta charset="utf-8">
  <title>React js</title>
  <!-- react cdn links _-->
  <script src="https://unpkg.com/react@17/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@17/umd/react-dom.production.min.js"></script>
  <!-- babel transpiler -->
  <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
  <!-- -->
  <style media="screen">
    #container {
      width: 300px;
      margin: 0 auto;
    }
  </style>
</head>

<body>
  <div id="container"></div>

  <script data-type="module" async type="text/babel">

    const output = document.getElementById('container');
    const PRODUCTS = [
  {category: 'Sporting Goods', price: '$49.99', stocked: true, name: 'Football'},
  {category: 'Sporting Goods', price: '$9.99', stocked: true, name: 'Baseball'},
  {category: 'Sporting Goods', price: '$29.99', stocked: false, name: 'Basketball'},
  {category: 'Electronics', price: '$99.99', stocked: true, name: 'iPod Touch'},
  {category: 'Electronics', price: '$399.99', stocked: false, name: 'iPhone 5'},
  {category: 'Electronics', price: '$199.99', stocked: true, name: 'Nexus 7'}
];

  // responsible for showing product rows
    class ProRows extends React.Component {
      render(){
        const product = this.props.product;
        let color=product.stocked?"":"red";
        return(
          <tr>
            <td style={{color:`${color}`}}>{product.name}</td>
            <td>{product.price}</td>
          </tr>
        );
      }
    }
  // responsible for holding category of product
    class ProCategory extends React.Component{
      render(){
        return(
          <tr>
            <th colspan="2">{this.props.category}</th>
          </tr>
        );
      }
    }
  // responsible for containing data
    class ProductTable extends React.Component{
      render(){
        // filter logic
        const rows=[];
        let checkCategory=null;
        this.props.products.forEach((product, i) => {
          if(product.name.indexOf(this.props.filter) === -1) {
            return;
          }
          if(this.props.isStock && !product.stocked){
            return;
          }
          if(product.category!=checkCategory){
            rows.push(<ProCategory category={product.category}/>)
          }
          checkCategory=product.category;
          rows.push(<ProRows product={product}/>)
        });
        // filter logic end

        return(
          <table border="1"  width="100%">
            <tr>
              <th><i>Name</i></th>
              <th><i>Price</i></th>
            </tr>
            {rows}
          </table>
        );
      }
    }
  // responsible for finding data
    class SearchBar extends React.Component {
      constructor(props){
        super(props);
        // binding methods
        this.hendleSearch=this.hendleSearch.bind(this);
        this.hendleCheckbox=this.hendleCheckbox.bind(this);
      }
      // hending search input with parant hendler
      hendleSearch(e){
        // passing value and name to neare parant method
        this.props.forHendleSearch(e.target.value);
      }
      // hending checkbox with parant hendler
      hendleCheckbox(e){
        this.props.forHendleCheckbox(e.target.checked);
      }
      // rendering element
      render(){
        return(
          <form>
            <input name="searchVal" type="text" style={{"width":"100%"}} value={this.props.inp} placeholder="Search" onChange={this.hendleSearch}/>
            <p style={{width:"100%"}}>
            <input name="isChecked" type="checkbox" checked={this.props.check} onChange={this.hendleCheckbox}/>
            {' '} <small>Show only stocked products!</small></p>
          </form>
        );
      }
    }
  // data container of filterable products table
    class FilterTableContainer extends React.Component {
      constructor(props) {
        super(props)
        this.state={
          searchVal:"",
          isChecked:false
        }
        this.hendleSearchBarInp=this.hendleSearchBarInp.bind(this);
        this.hendleSearchBarCheck = this.hendleSearchBarCheck.bind(this);
      }
      hendleSearchBarInp(passedVal){
        this.setState({
          searchVal:passedVal
        });
      }
      hendleSearchBarCheck(arg){
        this.setState({
          isChecked: arg
        });
      }
      render(){
        return(
          <React.Fragment>
            <h3 style={{color:"green"}}>Filterable Products Table</h3>

            <SearchBar forHendleCheckbox={this.hendleSearchBarCheck} forHendleSearch={this.hendleSearchBarInp} inp={this.state.searchVal} check={this.state.isChecked}/>

            <ProductTable filter={this.state.searchVal} isStock={this.state.isChecked} products={this.props.products} />
          </React.Fragment>
        );
      }
    }

    const input = <FilterTableContainer products={PRODUCTS}/>;
    ReactDOM.render(input, output);

  </script>


</body>

</html>
